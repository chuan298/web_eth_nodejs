<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
        table,
        td,
        th {
            border: 1px solid black;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        .btn:focus {
            outline: none;
            box-shadow: none;
        }
    </style>
    <title>Pool Chiacoinvn</title>
</head>

<body>
    <div class="page-wrapper">
        <div class="container">
            <img src="/image/logo.jpg" class="rounded mx-auto d-block" alt="...">

            <div class="col-sm"
                style="display: flex; align-items: center; justify-content: center; padding-top: 8px; padding-bottom: 8px; background-color: #3CAA5B; color: white;">
                Minimum payout is <%= user.minimum_payout %> XCH</div>
            <br />
            <div class="col" style="display: flex; align-items: center; justify-content: center;">
                <span>Account:&nbsp;&nbsp;</span>
                <span style="color: #3CAA5B;">
                    <%= user.wallet %>
                </span>
                <!-- <button type="button" class="btn btn-success" style="margin-left: 16px;">Success</button> -->
                <!-- Button to Open the Modal -->
                <button type="button" class="btn btn-success" data-toggle="modal" data-target="#myModal"
                    style="margin-left: 16px;">
                    Settings
                </button>

                <!-- The Modal -->
                <div class="modal fade" id="myModal">
                    <div class="modal-dialog modal-lg">
                        
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Settings</h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <form id="edit_minpayout_form" name="contact" role="form" >
                                <div class="modal-body">
                                    <div style="margin-left: 15px; margin-right: 15px;">
                                        <p>To change your account settings, you must specify new parameters and
                                            password(email of your workers). If you do not want to change some settings,
                                            leave fields of these settings blank.</p>
                                        <p>You must use one email for all of your workers.</p>
                                        <p>To be able to change your settings you must use the email optional parameter
                                            with
                                            every miner you have, and it's value must be the same. To find examples how
                                            to
                                            mine with email using your miner, please check the Help page (EMAIL /
                                            YOUR_EMAIL
                                            is what you should replace with your email). You can use a real email to
                                            receive
                                            offline workers notifications from the pool or just a secret word to access
                                            the
                                            settings.</p>
                                        <p>Every worker now has it's own rating - it is the number of shares, submitted
                                            with
                                            current email option. When you change the email in worker's configuration,
                                            rating is resetted to 0. When the worker is offline for 2+ days, it is
                                            automatically removed from the website and it's rating is resetted to 0 too.
                                        </p>
                                        <p>If you are getting "incorrect password" message:</p>
                                        <p>1) Check all the workers use the same email</p>
                                        <p>2) Workers have more than 10 rating</p>
                                        <p>3) There are no workers with high rating and old email (probably offline)</p>
                                    </div>
                                    <div class="form-group row">
                                        <label for="email" class="col-sm-3 col-form-label">Email</label>
                                        <div class="col-sm-9">
                                          <input required type="email" class="form-control" placeholder="name@example.com" id="email" name="email">
                                        </div>
                                      </div>
                                      <div class="form-group row">
                                        <label for="minimum_payout" class="col-sm-3 col-form-label">Minimum payout:</label>
                                        <div class="col-sm-3">
                                          <input required type="number" class="form-control" id="minimum_payout" name="minimum_payout" placeholder="Min 0.05. Max 20." min="0.05" max="20" step="0.001">
                                        </div>
                                        <label for="current_min_payout" class="col-sm-4 col-form-label">Current minimum payout:</label>
                                        <div class="col-sm-2">
                                            <input type="text" disabled class="form-control" id="current_min_payout" placeholder="Password"
                                               value="<%= user.minimum_payout %>">
                                          </div>
                                      </div>
                                      <p id= "message" style="text-align: center;"></p>
                                    


                                </div>
                                <div class="modal-footer">
                                    <input type="hidden" name="user_id" id="user_id" value="<%= user.wallet %>">					
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    <input type="submit" class="btn btn-success" id="submit">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div class="row" style="height: 160px;">
                <div class="col-sm d-flex flex-column">
                    <div style="flex: 1; display: flex; align-items: center; justify-content: center; background-color: #3CAA5B; color: white;"
                        class="text-center">
                        Average plot number
                        for last 6 hours
                    </div>
                    <div style="flex: 2; display: flex; align-items: center; justify-content: center; border-style: solid; border-width: thin; border-color: #3CAA5B;"
                        class="text-center">
                        <%= average_6h %>
                    </div>
                </div>
                <div class="col-sm d-flex flex-column">
                    <div style="flex: 1; display: flex; align-items: center; justify-content: center;background-color: #3CAA5B; color: white;"
                        class="text-center">
                        Last plot number
                    </div>
                    <div style="flex: 2; display: flex; align-items: center; justify-content: center; border-style: solid; border-width: thin; border-color: #3CAA5B;"
                        class="text-center">
                        <%= last_report %>
                    </div>
                </div>
                <div class="col-sm d-flex flex-column">
                    <div style="flex: 1; display: flex; align-items: center; justify-content: center; background-color: #3CAA5B; color: white;"
                        class="text-center">
                        Balance
                    </div>
                    <div style="flex: 2; border-style: solid; border-width: thin; border-color: #3CAA5B;"
                        class="text-center d-flex flex-column">
                        <div style="flex: 5; display: flex; align-items: center; justify-content: center;">
                            <span>
                                <%= balance %>
                            </span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-success" role="progressbar" style="width: <%= balance / user.minimum_payout * 100 %>%"
                                aria-valuenow="<%= balance / user.minimum_payout * 100 %>" aria-valuemin="0" aria-valuemax="100"><%= balance / user.minimum_payout * 100 %>%</div>
                        </div>
                    </div>



                </div>
            </div>

            <br />
            <br />
            <div class="row">

                <div class="col-lg-12">
                    <div id="myChart" style="min-width: 400px; max-width: 800px; height: 500px; margin: 0 auto"></div>
                </div>
            </div>
            <br />
            <br />
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                        aria-controls="home" aria-selected="true">Harvester</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
                        aria-controls="profile" aria-selected="false">Payments</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab"
                        aria-controls="contact" aria-selected="false">Minning History</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="calculator-tab" data-toggle="tab" href="#calculator" role="tab"
                        aria-controls="contact" aria-selected="false">Calculator</a>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                    <table style="border-collapse: collapse; width: 100%">
                        <colgroup>
                            <col span="1" style="width: 6%;">
                            <col span="1" style="width: 50%;">
                            <col span="1" style="width: 22%;">
                            <col span="1" style="width: 22%;">

                        </colgroup>
                        <thead>
                            <tr style="height: 50px;">
                                <td colspan="2" style="text-align: center;">Worker</td>
                                <td rowspan="2" style="text-align: center;">Plot number</td>

                            </tr>
                            <tr style="height: 50px;">
                                <td colspan="2">
                                    <div class="d-flex flex-row" style="align-items: center; justify-content: center;">
                                        <button type="button" class="btn btn-light">Online</button>
                                        <button type="button" class="btn btn-light">Offline</button>
                                        <button type="button" class="btn btn-light">Total</button>
                                    </div>

                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <% for(let i=0; i< harvesters.length; i++){ %>
                                <tr>
                                    <td style="text-align: center;">
                                        <%= i+1 %>
                                    </td>
                                    <td style="text-align: center; color: <%= harvesters[i].color%>;">
                                        <%= harvesters[i].harvester %>
                                    </td>
                                    <td style="text-align: center;">
                                        <%= harvesters[i].total_plots %>
                                    </td>
                                </tr>
                                <%}%>
                        </tbody>



                    </table>
                </div>
                <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                    <table style="border-collapse: collapse;">
                        <colgroup>
                            <col span="1" style="width: 25%;">
                            <col span="1" style="width: 60%;">
                            <col span="1" style="width: 15%;">
                        </colgroup>
                        <tr style="height: 50px;">
                            <td colspan="3">
                                <div class="d-flex flex-row" style="align-items: center; justify-content: center;">
                                    <span>Total paid: <%= total_paid %>  XCH&nbsp;&nbsp;</span>
                                    <button type="button" class="btn btn-success">CSV</button>

                                </div>
                            </td>

                        </tr>
                        <tr>
                            <td style="text-align: center;">Date</td>
                            <td style="text-align: center;">Amount</td>
                            <td style="text-align: center;">Status</td>
                        </tr>
                        <% for(let i=0; i< payments.length; i++){ %>
                            <tr>
                                <td style="text-align: center;">
                                    <%= payments[i].time %>
                                </td>
                                <td style="text-align: center;">
                                    <%= payments[i].amount %>
                                </td>
                                <td style="text-align: center;">
                                    &nbsp;
                                </td>
                            </tr>
                            <%}%>
                        <!-- <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr> -->
                    </table>
                </div>
                <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                    <table style="border-collapse: collapse;">
                        <colgroup>
                            <col span="1" style="width: 35%;">
                            <col span="1" style="width: 65%;">
                        </colgroup>
                        <tr>

                            <td style="text-align: center;">Date</td>
                            <td style="text-align: center;">Amount</td>
                        </tr>
                        <% for(let i=0; i< mining_histories.length; i++){ %>
                            <tr>
                                <td style="text-align: center;">
                                    <%= mining_histories[i].time %>
                                </td>
                                <td style="text-align: center;">
                                    <%= mining_histories[i].amount %>
                                </td>
                            </tr>
                            <%}%>
                    </table>
                    <br/>

                    <nav aria-label="Page navigation example">
                        <ul class="pagination justify-content-center">
                          <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Previous</a>
                          </li>
                          <li class="page-item"><a class="page-link" href="#">1</a></li>
                          <li class="page-item"><a class="page-link" href="#">2</a></li>
                          <li class="page-item"><a class="page-link" href="#">3</a></li>
                          <li class="page-item">
                            <a class="page-link" href="#">Next</a>
                          </li>
                        </ul>
                      </nav>
                    
                </div>
                <div class="tab-pane fade" id="calculator" role="tabpanel" aria-labelledby="calculator-tab">
                    <table style="border-collapse: collapse;">

                        <tr style="height: 50px;">
                            <td colspan="4" style="text-align: center;">
                                Very approximated earnings
                            </td>

                        </tr>
                        <tr>
                            <td style="text-align: center;">Period</td>
                            <td style="text-align: center;">ETH</td>
                            <td style="text-align: center;">BTC</td>
                            <td style="text-align: center;">USD</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                    </table>
                </div>
            </div>

        </div>
    </div>
    <br />
    <footer class="bg-light text-center text-lg-start">
        <!-- Copyright -->
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
            © 2021 Copyright
        </div>
        <!-- Copyright -->
    </footer>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/data.js"></script>
    <script src="https://code.highcharts.com/stock/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script>
        $(document).ready(function () {

            $(".nav-tabs li a").click(function () {
                $(this).tab('show');
            });

            ////
            $("#edit_minpayout_form").submit(function (event) {
                event.preventDefault();
                $('#submit').attr("disabled", true);
                $.ajax({
                    type: "POST",
                    url: "/edit_minimumpayout",
                    data: {
                        email: $('#email').val(),
                        minimum_payout: $('#minimum_payout').val(),
                        user_id: $("#user_id").val()
                    },
                    success: function (result) {
                        alert(result.message);
                    },
                    dataType: 'json',
                    error: function(result){
                        console.log(result)
                        alert(result);
                    }
                });
                $("#submit").prop("disabled", false);
            })
            ////

            // Create the chart
            Highcharts.stockChart('myChart', {
                chart: {
                    events: {
                        load: function () {

                            // set up the updating of the chart each second
                            var series = this.series[0];
                            setInterval(function () {
                                var x = (new Date()).getTime(), // current time
                                    y = Math.round(Math.random() * 100);
                                series.addPoint([x, y], true, true);
                            }, 1000);
                        }
                    }
                },

                time: {
                    useUTC: false
                },

                rangeSelector: {
                    buttons: [
                        {
                            count: 12,
                            type: 'hour',
                            text: '12H'
                        },
                        {
                            count: 1,
                            type: 'day',
                            text: '1D'
                        },
                        {
                            count: 3,
                            type: 'day',
                            text: '3D'
                        },
                        {
                            count: 7,
                            type: 'day',
                            text: '1W'
                        },
                        {
                            count: 1,
                            type: 'month',
                            text: '1M'
                        },
                        {
                            type: 'all',
                            text: 'All'
                        }
                    ],
                    // inputEnabled: false,
                    selected: 3
                },

                title: {
                    text: ''
                },
                yAxis: {
                    title: {
                        text: 'Total plots'
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }]
                },

                exporting: {
                    enabled: false
                },

                series: [{
                    name: 'total plots',
                    data: <%- data_chart %>
                    // (function () {
                    //     // generate an array of random data
                    //     var data = [],
                    //         time = (new Date()).getTime(),
                    //         i;

                    //     for (i = -19; i <= 0; i += 1) {
                    //         data.push([
                    //             time + i * 100000,
                    //             Math.round(Math.random() * 100)
                    //         ]);
                    //         // console.log(i)
                    //     }
                    //     console.log(data)
                    //     return data;
                    // }())
                }]
            });



        });



    </script>
</body>

</html>